#!/bin/sh
echo "π” μ½”λ“ μ¤νƒ€μΌ κ²€μ‚¬ μ¤‘..."
./gradlew ktlintCheck --daemon
status=$?
if [ "$status" = 0 ] ; then
    echo "β… μ½”λ“ μ¤νƒ€μΌ κ²€μ‚¬κ°€ ν†µκ³Όλμ—μµλ‹λ‹¤"
else
    echo "β οΈ μ½”λ“ μ¤νƒ€μΌ μ΄μκ°€ λ°κ²¬λμ—μµλ‹λ‹¤. μλ™ μμ •μ„ μ‹μ‘ν•©λ‹λ‹¤..."
    ./gradlew ktlintFormat --daemon
    # ν¬λ§·ν… ν›„ λ‹¤μ‹ ν•λ² μ²΄ν¬
    ./gradlew ktlintCheck --daemon
    final_status=$?
    if [ "$final_status" = 0 ] ; then
        echo "π”„ μ½”λ“ μ¤νƒ€μΌμ΄ μλ™μΌλ΅ μμ •λμ—μµλ‹λ‹¤. λ³€κ²½μ‚¬ν•­μ„ ν™•μΈν•κ³  λ‹¤μ‹ μ»¤λ°‹ν•΄μ£Όμ„Έμ”."
        exit 1
    else
        echo "β μλ™ μμ • ν›„μ—λ„ ν•΄κ²°λμ§€ μ•μ€ μ¤νƒ€μΌ μ΄μκ°€ μμµλ‹λ‹¤. μλ™μΌλ΅ μμ •ν•΄μ£Όμ„Έμ”."
        exit 1
    fi
fi

# ν…μ¤νΈ μ‹¤ν–‰ μ½”λ“
echo "π€ ν…μ¤νΈ μ‹¤ν–‰ μ¤‘..."
# Gradle ν…μ¤νΈ μ‹¤ν–‰
./gradlew test --parallel --continue
test_status=$?
if [ "$test_status" = 0 ] ; then
    echo "β… λ¨λ“  ν…μ¤νΈκ°€ μ„±κ³µμ μΌλ΅ ν†µκ³Όλμ—μµλ‹λ‹¤"
else
    echo "β ν…μ¤νΈ μ‹¤ν¨! μ‹¤ν¨ν• ν…μ¤νΈλ¥Ό μμ •ν• ν›„ λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”"
    exit 1
fi

# JAR λΉλ“
echo "π“¦ JAR νμΌ λΉλ“ μ¤‘..."
./gradlew bootJar
jar_status=$?
if [ "$jar_status" = 0 ] ; then
    echo "β… JAR νμΌμ΄ μ„±κ³µμ μΌλ΅ λΉλ“λμ—μµλ‹λ‹¤"
    exit 0
else
    echo "β JAR λΉλ“ μ‹¤ν¨! λΉλ“ μ¤λ¥λ¥Ό ν™•μΈν•΄μ£Όμ„Έμ”"
    exit 1
fi
